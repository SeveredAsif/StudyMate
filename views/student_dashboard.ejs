<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="/login.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/student/enroll-courses">Enroll Courses</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/student/course-lists">Course Lists</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Dropdown
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Give Feedback</a></li>
                            <li><a class="dropdown-item" href="#">Exam section</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Show Question and Answer</a></li>
                        </ul>
                    </li>
                </ul>
                <form class="d-flex" role="search">
                    <input type="hidden" id="searchCategory" value="">
                    <div class="dropdown me-2">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="searchCategoryDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Search by
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="searchCategoryDropdown">
                            <li><a class="dropdown-item" href="#" onclick="changeSearchCategory('teacher')">Teacher</a>
                            </li>
                            <li><a class="dropdown-item" href="#" onclick="changeSearchCategory('course')">Course</a>
                            </li>

                        </ul>
                    </div>
                    <input type="text" id="searchTermInput" placeholder="Enter search term" oninput="searchc()">
                    <ul id="autocompleteList" class="dropdown-menu" style="display:none;"></ul>
                    <button class="btn btn-primary" onclick="searchc()">Search</button>
                </form>
            </div>
        </div>
    </nav>

    <div>
        <h1>Welcome <%= userType %>!</h1>
    </div>

    <script>
        function changeSearchCategory(category) {
            document.getElementById("searchCategory").value = category;
            document.getElementById("searchCategoryDropdown").innerText = "Search by " + category.charAt(0).toUpperCase() + category.slice(1);
        }

        function searchc() {
            const category = document.getElementById("searchCategory").value;
            const searchTerm = document.getElementById("searchTermInput").value;

            if (category && searchTerm) {
                // Perform the search and update the results
                // Example using fetch for demonstration purposes; replace with your actual implementation
                fetch(`/api/search/${category}?q=${searchTerm}`)
                    .then(response => response.json())
                    .then(data => {
                        displayAutocompleteResults(data, category);
                        console.log("........................");
                        console.log(data);
                    })
                    .catch(error => console.error('Error fetching search results:', error));

            } else {
                // Clear the results if either category or searchTerm is empty
                document.getElementById("autocompleteList").innerHTML = '';
            }
        }

        function displayAutocompleteResults(results, category) {
            const autocompleteList = document.getElementById("autocompleteList");

            // Clear previous results
            autocompleteList.innerHTML = '';
            if (category === 'teacher') {
                if (results.length > 0) {
                    results.forEach(result => {
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `<a class="dropdown-item" href="#" onclick="selectAutocompleteResult('${result.teacher_name}')">${result.teacher_name}</a>`;
                        autocompleteList.appendChild(listItem);
                    });

                    // Display the autocomplete list
                    autocompleteList.style.display = 'block';
                } else {
                    // Hide the autocomplete list if no results
                    autocompleteList.style.display = 'none';
                }
            }
            if (category === 'course') {
                if (results.length > 0) {
                    results.forEach(result => {
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `<a class="dropdown-item" href="#" onclick="selectAutocompleteResult('${result.course_title}')">${result.course_title}</a>`;
                        autocompleteList.appendChild(listItem);
                    });

                    // Display the autocomplete list
                    autocompleteList.style.display = 'block';
                } else {
                    // Hide the autocomplete list if no results
                    autocompleteList.style.display = 'none';
                }
            }
        }

        function selectAutocompleteResult(result) {
            // Set the selected result as the value of the search bar
            document.getElementById("searchTermInput").value = result;
            // Hide the autocomplete list
            document.getElementById("autocompleteList").style.display = 'none';
        }
    </script>
</body>

</html>